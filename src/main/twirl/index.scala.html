<!DOCTYPE html>
<html>
  <head>
    <script src="https://code.jquery.com/jquery-2.1.4.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.3.0/knockout-min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.6/moment.min.js"></script>
    <link rel="stylesheet" type="text/css" href="matchmaking/css/site.css">

    <meta charset="utf-8">
    <title>HOTSextra matchmaker</title>
  </head>
  <body>
  <a href="https://github.com/martijnhoekstra/hotsextra-matchmaker"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/a6677b08c955af8400f44c6298f40e7d19cc5b2d/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677261795f3664366436642e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"></a>
    <h1>Test the matchmaker through this rudimentary interface!</h1>
    <fieldset>
      <h3>setup matchmaker instance</h3>
      <p>These paramaters set the matchmaking algorithm</p>
      <p>Once you start running, the matchmaker starts, and they can't be changed anymore. To change them later, refresh the page.</p>
      <ul data-bind="with: basic">
        <li title="The 'score' is the target std of MMR averages"><input type="text" data-bind="value: target"> target score</li>
        <li title="Time starts to reduce the target score after this time in seconds"><input type="text" data-bind="value: startseconds"> time starts at</li>
        <li title="The number of points per second to subtract from the target score after the above timer expires"><input type="text" data-bind="value: secondsperpoint"> seconds per point</li>
        <li title="The matchmaker will put players together on mmr - (n σ). This will artificially deflate the matchmaking of newcomers">Deflate MMR by <input type="text" data-bind="value: adjustMMR"> times uncertainty</li>
      </ul>
    </fieldset>
    <fieldset>
      <h3>entry generation</h3>
      <p>These parameters define the test entries that are being created.</p>
      <p>Entries are generated with an MMR that consists of an expectency value and a number of games played. The MMR expectency values are generated by a seeded pseudorandom gaussian.
      The standard deviation of a players MMR is unscientifically estimated at 500 / log(x<sup>2</sup>/2 + e) because it sort of looks nice (I'm very welcome to better suggestions; <a href="https://github.com/martijnhoekstra/hotsextra-matchmaker/issues">open an issue on github</a>). That gives an uncertainty of 500 for a brand new player, about 100 after 20 games played, 60 after 100 games, and about 25 after 10k games.</p>
      <p>This gives the entry generator an edge case where new players (with less than 10 games played) can have an MMR that is not possible, for example, an MMR of 3500 with 0 games played. Though the uncertainty smooths this out somewhat (that very rare case would match the player at an ajusted MMR of 2500 with the default 2σ uncertainty modifier) it's still less then ideal. Please just look slightly the other way when those cases happen; it's a reflection of entity generation only, not the matchmaker itself.</p>
      <ul data-bind="with: generation">
        <li><input type="text" data-bind="value: seed"> the seed to use for random number generation</li>
        <li><input type="text" data-bind="value: avgmmr"> expectency value of MMR per player</li>
        <li><input type="text" data-bind="value: stdmmr"> standard deviation of expectency values</li>
        <li><input type="text" data-bind="value: avggamesplayed"> Average total number of games played per player</li>
        <li><input type="text" data-bind="value: speed"> entries per second</li>
      </ul>
      <input type="button" value="run" data-bind="click: runsocket, enable: !running()"></input>
      <input type="button" value="stop" data-bind="click: stopgeneration, enable: running()"></input>
    </fieldset>
    <div data-bind="with: results">
      <div id="waiting">
      <h2><span data-bind="text: numwaiting"></span> waiting players</h2>
      <table>
        <thead>
          <tr>
            <th>MMR</th>
            <th>#games</th>
            <th>σ</th>
            <th colspan="2">interval</th>
            <th>queued</th>
          </tr>
        </thead>
        <tbody data-bind="foreach: waiting">
          <tr>
            <td data-bind="text: mmr"></td>
            <td data-bind="text: played"></td>
            <td data-bind="text: sigma"></td>
            <td data-bind="text: minMMR"></td>
            <td data-bind="text: maxMMR"></td>
            <td data-bind="text: waitingFor"></td>
          </tr>
        </tbody>
      </table>
      </div>
      <div id="found">
      <h2>Most recently found matches</h2>
      <ul data-bind="foreach: found">
        <li>
          <table>
            <tr>
              <th>MMR</th>
              <th>games played</th>
              <th>time waited</th>
              <th>vs</th>
              <th>MMR</th>
              <th>games played</th>
              <th>time waited</th>
            </tr>
            <tbody data-bind="foreach: pairs">
              <tr>
                <td><span data-bind="text: p1mmr"></span></td>
                <td><span data-bind="text: p1played"></span></td>
                <td><span data-bind="text: p1waited"></span> seconds</td>
                <td></td>
                <td><span data-bind="text: p2mmr"></span></td>
                <td><span data-bind="text: p2played"></span></td>
                <td><span data-bind="text: p2waited"></span> seconds</td>
              </tr>
            </tbody>
          </table>
        </li>
      </ul>
      </div>
    </div>
  </body>
  <script src="matchmaking/script/random"></script>
  <script src="matchmaking/script/site"></script>
</html>